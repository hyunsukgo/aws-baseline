{% set AWSSubAccounts = [ 

                          { 'Id': '763718361067', 'Email': 'skmagic_it05@skmagic.com'},
                          { 'Id': '185302376606', 'Email': 'skmagic_it06@skmagic.com'},
                          { 'Id': '518471655024', 'Email': 'skmagic_it07@skmagic.com'},
                          { 'Id': '457258694188', 'Email': 'skmagic_it08@skmagic.com'},
                          { 'Id': '512758715856', 'Email': 'skmagic_it09@skmagic.com'},
                          ] %}

Resources:
  GuardDutyDetector:
    Type: "AWS::GuardDuty::Detector"
    Properties:
      Enable: true

  {% for Account in AWSSubAccounts %}
  GuardDutyMember{{Account['Id']}}:
    DependsOn:
      - GuardDutyDetector
      {% if loop.index > 1 %}
      - GuardDutyMember{{AWSSubAccounts[loop.index-2]['Id']}}
      {% endif%}
    Type: "AWS::GuardDuty::Member"
    Properties:
      Status: "Invited"
      MemberId: "{{Account['Id']}}"
      Email: "{{Account['Email']}}"
      Message: "You are invited to enable Amazon Guardduty."
      DetectorId: !Ref GuardDutyDetector
      DisableEmailNotification: false
  {% endfor %}
